<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hardware Store Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://unpkg.com/quagga"></script>
    <style>
        .neo-box {
            border-radius: 20px;
            background: #e0e5ec;
            box-shadow: 20px 20px 60px #bec3c9, -20px -20px 60px #ffffff;
        }
        .neo-button {
            border-radius: 12px;
            background: #e0e5ec;
            box-shadow: 5px 5px 15px #bec3c9, -5px -5px 15px #ffffff;
            transition: all 0.3s ease;
        }
        .neo-button:active {
            box-shadow: inset 5px 5px 15px #bec3c9, inset -5px -5px 15px #ffffff;
        }
        #interactive.viewport {
            position: relative;
            width: 100%;
            height: 300px;
        }
        #interactive.viewport > canvas, #interactive.viewport > video {
            max-width: 100%;
            width: 100%;
        }
        canvas.drawing, canvas.drawingBuffer {
            position: absolute;
            left: 0;
            top: 0;
        }
    </style>
</head>
<body class="bg-[#e0e5ec] min-h-screen">
    <!-- Login Section -->
    <div id="loginSection" class="flex items-center justify-center min-h-screen">
        <div class="neo-box p-8 w-full max-w-md">
            <h2 class="text-2xl font-bold mb-6 text-gray-700 text-center">Hardware Store Management</h2>
            <form id="loginForm" class="space-y-4">
                <div>
                    <input type="text" id="username" placeholder="Username" class="w-full p-3 rounded-lg bg-[#e0e5ec] neo-button">
                </div>
                <div>
                    <input type="password" id="password" placeholder="Password" class="w-full p-3 rounded-lg bg-[#e0e5ec] neo-button">
                </div>
                <button type="submit" class="w-full p-3 neo-button text-gray-700 font-semibold hover:opacity-90">Login</button>
            </form>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden p-4">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <!-- Dashboard Cards -->
            <div class="neo-box p-6">
                <h3 class="text-gray-700 text-lg font-semibold mb-2">Total Stock</h3>
                <p id="totalStock" class="text-2xl font-bold text-gray-800">0</p>
            </div>
            <div class="neo-box p-6">
                <h3 class="text-gray-700 text-lg font-semibold mb-2">Daily Sales</h3>
                <p id="dailySales" class="text-2xl font-bold text-gray-800">₹0</p>
            </div>
            <div class="neo-box p-6">
                <h3 class="text-gray-700 text-lg font-semibold mb-2">Total Earnings</h3>
                <p id="totalEarnings" class="text-2xl font-bold text-gray-800">₹0</p>
            </div>
            <div class="neo-box p-6">
                <h3 class="text-gray-700 text-lg font-semibold mb-2">Net Profit</h3>
                <p id="netProfit" class="text-2xl font-bold text-gray-800">₹0</p>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
            <!-- Product Management -->
            <div class="neo-box p-6 lg:col-span-2">
                <h3 class="text-xl font-semibold mb-4 text-gray-700">Product Management</h3>
                <div class="space-y-4">
                    <div class="flex space-x-2">
                        <input type="text" id="searchProduct" placeholder="Search Products" class="flex-1 p-2 neo-button">
                        <button id="scanButton" class="neo-button p-2 px-4">
                            <i class="bi bi-upc-scan"></i> Scan
                        </button>
                    </div>
                    <div id="scanner" class="hidden">
                        <div id="interactive" class="viewport neo-box"></div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="text-left">
                                    <th class="p-2">Product</th>
                                    <th class="p-2">Stock</th>
                                    <th class="p-2">Price</th>
                                    <th class="p-2">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="productTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="space-y-4">
                <div class="neo-box p-6">
                    <h3 class="text-xl font-semibold mb-4 text-gray-700">Quick Actions</h3>
                    <div class="space-y-3">
                        <button id="addProductBtn" class="neo-button w-full p-3 text-left">
                            <i class="bi bi-plus-circle mr-2"></i> Add New Product
                        </button>
                        <button id="createInvoiceBtn" class="neo-button w-full p-3 text-left">
                            <i class="bi bi-receipt mr-2"></i> Create Invoice
                        </button>
                        <button id="manageCustomersBtn" class="neo-button w-full p-3 text-left">
                            <i class="bi bi-people mr-2"></i> Manage Customers
                        </button>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="neo-box p-6">
                    <h3 class="text-xl font-semibold mb-4 text-gray-700">Recent Activity</h3>
                    <div id="recentActivity" class="space-y-2">
                        <!-- Activities will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="productModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
        <div class="neo-box p-6 w-full max-w-md">
            <h3 class="text-xl font-semibold mb-4 text-gray-700">Add/Edit Product</h3>
            <form id="productForm" class="space-y-4">
                <input type="text" id="productName" placeholder="Product Name" class="w-full p-2 neo-button">
                <input type="text" id="barcode" placeholder="Barcode" class="w-full p-2 neo-button">
                <input type="number" id="buyingPrice" placeholder="Buying Price" class="w-full p-2 neo-button">
                <input type="number" id="sellingPrice" placeholder="Selling Price" class="w-full p-2 neo-button">
                <input type="number" id="quantity" placeholder="Quantity" class="w-full p-2 neo-button">
                <input type="text" id="supplier" placeholder="Supplier Details" class="w-full p-2 neo-button">
                <div class="flex space-x-2">
                    <button type="submit" class="neo-button p-2 flex-1">Save</button>
                    <button type="button" onclick="closeModal('productModal')" class="neo-button p-2 flex-1">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Initialize variables
        let products = [];
        let customers = [];
        let currentUser = null;

        // Login Handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Simple validation (replace with actual authentication)
            if (username === 'admin' && password === 'admin123') {
                currentUser = { username, role: 'admin' };
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                loadDashboard();
            } else {
                alert('Invalid credentials');
            }
        });

        // Barcode Scanner Implementation
        document.getElementById('scanButton').addEventListener('click', () => {
            const scanner = document.getElementById('scanner');
            if (scanner.classList.contains('hidden')) {
                scanner.classList.remove('hidden');
                initializeScanner();
            } else {
                scanner.classList.add('hidden');
                Quagga.stop();
            }
        });

        function initializeScanner() {
            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector("#interactive"),
                    constraints: {
                        facingMode: "environment"
                    },
                },
                decoder: {
                    readers: ["ean_reader", "ean_8_reader", "upc_reader", "upc_e_reader"]
                }
            }, function(err) {
                if (err) {
                    console.error(err);
                    return;
                }
                Quagga.start();
            });

            Quagga.onDetected((result) => {
                const code = result.codeResult.code;
                handleBarcodeDetection(code);
            });
        }

        async function handleBarcodeDetection(barcode) {
            // Check if product exists
            const response = await fetch('https://r0c8kgwocscg8gsokogwwsw4.zetaverse.one/mongodb', {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer chVfl1mlDLS1wAUXRlIHA7bjDWq1',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    appSlug: 'dynamic-golden-swift-6601',
                    action: 'read',
                    collection: 'products',
                    conditions: { barcode: barcode }
                })
            });
            
            const data = await response.json();
            if (data.result.length > 0) {
                // Product exists - update quantity for sale
                const product = data.result[0];
                if (confirm(`Sell 1 unit of ${product.name}?`)) {
                    await updateProductQuantity(product._id, product.quantity - 1);
                }
            } else {
                // New product - open modal for adding
                document.getElementById('barcode').value = barcode;
                document.getElementById('productModal').classList.remove('hidden');
            }
            
            // Stop scanner after detection
            Quagga.stop();
            document.getElementById('scanner').classList.add('hidden');
        }

        async function updateProductQuantity(productId, newQuantity) {
            try {
                const response = await fetch('https://r0c8kgwocscg8gsokogwwsw4.zetaverse.one/mongodb', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer chVfl1mlDLS1wAUXRlIHA7bjDWq1',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        appSlug: 'dynamic-golden-swift-6601',
                        action: 'update',
                        collection: 'products',
                        id: productId,
                        data: { quantity: newQuantity }
                    })
                });
                
                if (response.ok) {
                    loadDashboard();
                }
            } catch (error) {
                console.error('Error updating product:', error);
            }
        }

        // Dashboard Functions
        async function loadDashboard() {
            try {
                const response = await fetch('https://r0c8kgwocscg8gsokogwwsw4.zetaverse.one/mongodb', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer chVfl1mlDLS1wAUXRlIHA7bjDWq1',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        appSlug: 'dynamic-golden-swift-6601',
                        action: 'read',
                        collection: 'products'
                    })
                });
                
                const data = await response.json();
                products = data.result;
                updateDashboardStats();
                renderProductTable();
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        function updateDashboardStats() {
            const totalStock = products.reduce((acc, product) => acc + product.quantity, 0);
            const totalValue = products.reduce((acc, product) => acc + (product.sellingPrice * product.quantity), 0);
            
            document.getElementById('totalStock').textContent = totalStock;
            document.getElementById('totalEarnings').textContent = `₹${totalValue.toFixed(2)}`;
        }

        function renderProductTable() {
            const tableBody = document.getElementById('productTable');
            tableBody.innerHTML = '';
            
            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="p-2">${product.name}</td>
                    <td class="p-2">${product.quantity}</td>
                    <td class="p-2">₹${product.sellingPrice}</td>
                    <td class="p-2">
                        <button onclick="editProduct('${product._id}')" class="neo-button p-1 px-2 mr-2">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button onclick="deleteProduct('${product._id}')" class="neo-button p-1 px-2">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Modal Functions
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // Event Listeners
        document.getElementById('addProductBtn').addEventListener('click', () => {
            document.getElementById('productModal').classList.remove('hidden');
        });

        document.getElementById('productForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const productData = {
                name: document.getElementById('productName').value,
                barcode: document.getElementById('barcode').value,
                buyingPrice: parseFloat(document.getElementById('buyingPrice').value),
                sellingPrice: parseFloat(document.getElementById('sellingPrice').value),
                quantity: parseInt(document.getElementById('quantity').value),
                supplier: document.getElementById('supplier').value
            };

            try {
                const response = await fetch('https://r0c8kgwocscg8gsokogwwsw4.zetaverse.one/mongodb', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer chVfl1mlDLS1wAUXRlIHA7bjDWq1',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        appSlug: 'dynamic-golden-swift-6601',
                        action: 'create',
                        collection: 'products',
                        data: productData
                    })
                });

                if (response.ok) {
                    closeModal('productModal');
                    loadDashboard();
                    e.target.reset();
                }
            } catch (error) {
                console.error('Error adding product:', error);
            }
        });

        // Initialize dashboard if needed
        if (currentUser) {
            loadDashboard();
        }
    </script>
<script>document.body.addEventListener('wheel', e => { if (!e.ctrlKey) return; e.preventDefault(); return }, { passive: false })</script>
	</body>
</html>